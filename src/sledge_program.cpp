#include <string.h>
#include "sledge_program.h"

const char * const SLEDGE_CATEGORY_NAMES[] = {
  "INIT", "ARP", "ATMO", "BASS",
  "DRUM", "FX", "KEYS", "LEAD",
  "MONO", "PAD", "PERC", "POLY",
  "SEQ "
};

static byte ip_header[3] = {0x15, 0x00, 0x10};
static byte data[] = {
    0x02,0x40,0x40,0x40,0x42,0x60,0x00,0x00,
    0x01,0x40,0x00,0x40,0x00,0x00,0x00,0x00,
    0x00,0x40,0x40,0x40,0x42,0x60,0x01,0x00,
    0x01,0x40,0x00,0x40,0x00,0x00,0x00,0x00,
    0x00,0x34,0x40,0x40,0x42,0x60,0x02,0x00,
    0x01,0x40,0x00,0x40,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,
    0x00,0x14,0x00,0x00,0x00,0x7f,0x01,0x7f,
    0x01,0x7f,0x01,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x01,0x7f,0x40,
    0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x40,
    0x40,0x00,0x40,0x00,0x00,0x40,0x00,0x40,
    0x00,0x00,0x7f,0x40,0x00,0x00,0x00,0x00,
    0x00,0x00,0x40,0x40,0x40,0x00,0x40,0x00,
    0x40,0x40,0x00,0x40,0x00,0x00,0x03,0x00,
    0x00,0x7f,0x72,0x00,0x40,0x00,0x00,0x00,
    0x00,0x00,0x14,0x40,0x40,0x00,0x7f,0x7f,
    0x7f,0x7f,0x7f,0x7f,0x7f,0x7f,0x7f,0x7f,
    0x00,0x10,0x35,0x40,0x64,0x00,0x40,0x64,
    0x00,0x64,0x6e,0x00,0x0f,0x40,0x7f,0x7f,
    0x00,0x32,0x40,0x00,0x00,0x00,0x00,0x40,
    0x00,0x40,0x40,0x00,0x00,0x28,0x40,0x00,
    0x00,0x00,0x00,0x40,0x00,0x40,0x40,0x00,
    0x00,0x1e,0x40,0x00,0x00,0x00,0x00,0x40,
    0x00,0x40,0x40,0x01,0x00,0x40,0x00,0x00,
    0x7f,0x32,0x00,0x00,0x7f,0x00,0x00,0x00,
    0x00,0x40,0x00,0x00,0x7f,0x34,0x7f,0x00,
    0x7f,0x00,0x00,0x00,0x00,0x40,0x00,0x00,
    0x40,0x40,0x40,0x40,0x40,0x40,0x00,0x00,
    0x00,0x40,0x00,0x00,0x40,0x40,0x40,0x40,
    0x40,0x40,0x00,0x00,0x01,0x10,0x0d,0x06,
    0x40,0x19,0x05,0x02,0x40,0x00,0x00,0x00,
    0x40,0x00,0x00,0x00,0x40,0x01,0x01,0x40,
    0x01,0x00,0x40,0x01,0x00,0x40,0x03,0x00,
    0x40,0x03,0x00,0x40,0x03,0x00,0x40,0x1a,
    0x00,0x40,0x1a,0x00,0x40,0x1a,0x00,0x40,
    0x00,0x00,0x40,0x00,0x00,0x40,0x00,0x00,
    0x40,0x00,0x00,0x40,0x00,0x00,0x40,0x00,
    0x00,0x40,0x00,0x00,0x40,0x10,0x64,0x00,
    0x00,0x0f,0x08,0x05,0x00,0x00,0x00,0x00,
    0x0c,0x00,0x00,0x0f,0x00,0x00,0x37
};
static byte data2[] = {0x00, 0x00, 0x00, 0x52};

SledgeProgram::SledgeProgram() {
  initialize();
}

void SledgeProgram::initialize() {
  sysex = SYSEX;
  waldorf = WALDORF_MANUFACTURER_ID;
  memcpy(&header, ip_header, sizeof(ip_header));
  set_program_number(0);
  memcpy(&data, data, sizeof(data));
  memset(&sixteen_fours, 0x04, sizeof(sixteen_fours));
  memset(&seventeen_forty_fours, 0x44,
         sizeof(seventeen_forty_fours));
  memset(&three_zeroes, 0, sizeof(three_zeroes));
  strncpy((char *)&name, "Init            ", 16);
  category = SLEDGE_CATEGORY_INIT;
  memcpy(&data2, &data2, sizeof(data2));
  eox = EOX;

  update();
}

void SledgeProgram::update() {
  memcpy(name_string, name, SLEDGE_PROGRAM_NAME_LEN);
  name_string[SLEDGE_PROGRAM_NAME_LEN] = 0;
  for (char *p = &name_string[SLEDGE_PROGRAM_NAME_LEN-1]; p >= name_string && *p == ' '; --p)
    *p = 0;
  strncpy(category_string, SLEDGE_CATEGORY_NAMES[category], 5);
  category_string[4] = 0;
}
